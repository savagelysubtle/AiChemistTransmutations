"""Error code registry for standardized fail codes.

This module defines error codes for all conversion failures, enabling
precise tracking and debugging of issues across all converters.
"""

from enum import Enum


class ErrorCategory(str, Enum):
    """Categories of errors for grouping."""

    VALIDATION = "VALIDATION"
    CONVERSION = "CONVERSION"
    FILE_OPERATION = "FILE_OPERATION"
    DEPENDENCY = "DEPENDENCY"
    LICENSE = "LICENSE"
    SECURITY = "SECURITY"
    MEMORY = "MEMORY"
    TIMEOUT = "TIMEOUT"
    OCR = "OCR"
    CONFIGURATION = "CONFIGURATION"


class ErrorCode:
    """Error code registry with standardized codes for all failure types.

    Format: {CATEGORY}_{CONVERTER}_{SPECIFIC_ERROR}
    Example: CONVERSION_MD2PDF_FILE_NOT_FOUND
    """

    # Validation Errors (1000-1999)
    VALIDATION_FILE_NOT_FOUND = "VALIDATION_001"
    VALIDATION_INVALID_FORMAT = "VALIDATION_002"
    VALIDATION_FILE_TOO_LARGE = "VALIDATION_003"
    VALIDATION_INVALID_PATH = "VALIDATION_004"
    VALIDATION_MISSING_REQUIRED_PARAM = "VALIDATION_005"
    VALIDATION_INVALID_PARAM_VALUE = "VALIDATION_006"
    VALIDATION_UNSUPPORTED_ENCODING = "VALIDATION_007"

    # Conversion Errors - Markdown (2000-2099)
    CONVERSION_MD2PDF_LIBRARY_MISSING = "CONVERSION_MD2PDF_001"
    CONVERSION_MD2PDF_READ_FAILED = "CONVERSION_MD2PDF_002"
    CONVERSION_MD2PDF_GENERATION_FAILED = "CONVERSION_MD2PDF_003"
    CONVERSION_MD2PDF_SAVE_FAILED = "CONVERSION_MD2PDF_004"
    CONVERSION_MD2HTML_FAILED = "CONVERSION_MD2HTML_001"
    CONVERSION_MD2DOCX_FAILED = "CONVERSION_MD2DOCX_001"
    CONVERSION_MD2EPUB_FAILED = "CONVERSION_MD2EPUB_001"

    # Conversion Errors - PDF (2100-2199)
    CONVERSION_PDF2MD_READ_FAILED = "CONVERSION_PDF2MD_001"
    CONVERSION_PDF2MD_TEXT_EXTRACTION_FAILED = "CONVERSION_PDF2MD_002"
    CONVERSION_PDF2MD_OCR_FAILED = "CONVERSION_PDF2MD_003"
    CONVERSION_PDF2MD_SAVE_FAILED = "CONVERSION_PDF2MD_004"
    CONVERSION_PDF2HTML_FAILED = "CONVERSION_PDF2HTML_001"
    CONVERSION_PDF2XLSX_FAILED = "CONVERSION_PDF2XLSX_001"
    CONVERSION_PDF2IMAGES_FAILED = "CONVERSION_PDF2IMAGES_001"
    CONVERSION_PDF_COMPRESS_FAILED = "CONVERSION_PDF_COMPRESS_001"
    CONVERSION_PDF_ENCRYPT_FAILED = "CONVERSION_PDF_ENCRYPT_001"
    CONVERSION_PDF_SPLIT_FAILED = "CONVERSION_PDF_SPLIT_001"
    CONVERSION_PDF_WATERMARK_FAILED = "CONVERSION_PDF_WATERMARK_001"
    CONVERSION_PDF_OCR_LAYER_FAILED = "CONVERSION_PDF_OCR_LAYER_001"

    # Conversion Errors - DOCX (2200-2299)
    CONVERSION_DOCX2MD_READ_FAILED = "CONVERSION_DOCX2MD_001"
    CONVERSION_DOCX2MD_PARSE_FAILED = "CONVERSION_DOCX2MD_002"
    CONVERSION_DOCX2MD_SAVE_FAILED = "CONVERSION_DOCX2MD_003"
    CONVERSION_DOCX2PDF_LIBRARY_MISSING = "CONVERSION_DOCX2PDF_001"
    CONVERSION_DOCX2PDF_CONVERSION_FAILED = "CONVERSION_DOCX2PDF_002"
    CONVERSION_DOCX2EPUB_FAILED = "CONVERSION_DOCX2EPUB_001"

    # Conversion Errors - HTML (2300-2399)
    CONVERSION_HTML2PDF_ENGINE_MISSING = "CONVERSION_HTML2PDF_001"
    CONVERSION_HTML2PDF_CONVERSION_FAILED = "CONVERSION_HTML2PDF_002"
    CONVERSION_HTML2EPUB_FAILED = "CONVERSION_HTML2EPUB_001"

    # Conversion Errors - Excel/CSV (2400-2499)
    CONVERSION_XLSX2PDF_READ_FAILED = "CONVERSION_XLSX2PDF_001"
    CONVERSION_XLSX2PDF_GENERATION_FAILED = "CONVERSION_XLSX2PDF_002"
    CONVERSION_XLSX2CSV_FAILED = "CONVERSION_XLSX2CSV_001"
    CONVERSION_XLSX2HTML_FAILED = "CONVERSION_XLSX2HTML_001"
    CONVERSION_XLSX2MD_FAILED = "CONVERSION_XLSX2MD_001"
    CONVERSION_CSV2PDF_READ_FAILED = "CONVERSION_CSV2PDF_001"
    CONVERSION_CSV2PDF_GENERATION_FAILED = "CONVERSION_CSV2PDF_002"
    CONVERSION_CSV2XLSX_FAILED = "CONVERSION_CSV2XLSX_001"

    # Conversion Errors - PowerPoint (2500-2599)
    CONVERSION_PPTX2PDF_READ_FAILED = "CONVERSION_PPTX2PDF_001"
    CONVERSION_PPTX2PDF_GENERATION_FAILED = "CONVERSION_PPTX2PDF_002"
    CONVERSION_PPTX2HTML_FAILED = "CONVERSION_PPTX2HTML_001"
    CONVERSION_PPTX2MD_FAILED = "CONVERSION_PPTX2MD_001"
    CONVERSION_PPTX2IMAGES_FAILED = "CONVERSION_PPTX2IMAGES_001"

    # Conversion Errors - Image (2600-2699)
    CONVERSION_IMAGE2PDF_READ_FAILED = "CONVERSION_IMAGE2PDF_001"
    CONVERSION_IMAGE2PDF_GENERATION_FAILED = "CONVERSION_IMAGE2PDF_002"
    CONVERSION_IMAGE2TEXT_OCR_FAILED = "CONVERSION_IMAGE2TEXT_001"
    CONVERSION_IMAGE2IMAGE_PROCESSING_FAILED = "CONVERSION_IMAGE2IMAGE_001"

    # Conversion Errors - EPUB (2700-2799)
    CONVERSION_EPUB2PDF_READ_FAILED = "CONVERSION_EPUB2PDF_001"
    CONVERSION_EPUB2PDF_GENERATION_FAILED = "CONVERSION_EPUB2PDF_002"
    CONVERSION_EPUB2MD_FAILED = "CONVERSION_EPUB2MD_001"
    CONVERSION_EPUB2HTML_FAILED = "CONVERSION_EPUB2HTML_001"
    CONVERSION_EPUB2DOCX_FAILED = "CONVERSION_EPUB2DOCX_001"

    # Conversion Errors - TXT (2800-2899)
    CONVERSION_TXT2PDF_READ_FAILED = "CONVERSION_TXT2PDF_001"
    CONVERSION_TXT2PDF_GENERATION_FAILED = "CONVERSION_TXT2PDF_002"

    # File Operation Errors (3000-3099)
    FILE_OPERATION_READ_FAILED = "FILE_OPERATION_001"
    FILE_OPERATION_WRITE_FAILED = "FILE_OPERATION_002"
    FILE_OPERATION_COPY_FAILED = "FILE_OPERATION_003"
    FILE_OPERATION_DELETE_FAILED = "FILE_OPERATION_004"
    FILE_OPERATION_PERMISSION_DENIED = "FILE_OPERATION_005"
    FILE_OPERATION_DISK_FULL = "FILE_OPERATION_006"
    FILE_OPERATION_LOCKED = "FILE_OPERATION_007"

    # Dependency Errors (4000-4099)
    DEPENDENCY_MISSING_LIBRARY = "DEPENDENCY_001"
    DEPENDENCY_MISSING_EXECUTABLE = "DEPENDENCY_002"
    DEPENDENCY_VERSION_MISMATCH = "DEPENDENCY_003"
    DEPENDENCY_IMPORT_ERROR = "DEPENDENCY_004"

    # License Errors (5000-5099)
    LICENSE_FEATURE_NOT_ACCESSIBLE = "LICENSE_001"
    LICENSE_TRIAL_EXPIRED = "LICENSE_002"
    LICENSE_FILE_SIZE_LIMIT_EXCEEDED = "LICENSE_003"
    LICENSE_INVALID_KEY = "LICENSE_004"

    # Security Errors (6000-6099)
    SECURITY_PATH_TRAVERSAL = "SECURITY_001"
    SECURITY_DANGEROUS_FILE_TYPE = "SECURITY_002"
    SECURITY_UNAUTHORIZED_ACCESS = "SECURITY_003"

    # Memory Errors (7000-7099)
    MEMORY_OUT_OF_MEMORY = "MEMORY_001"
    MEMORY_FILE_TOO_LARGE = "MEMORY_002"
    MEMORY_ALLOCATION_FAILED = "MEMORY_003"

    # Timeout Errors (8000-8099)
    TIMEOUT_CONVERSION_TIMEOUT = "TIMEOUT_001"
    TIMEOUT_OPERATION_TIMEOUT = "TIMEOUT_002"

    # OCR Errors (9000-9099)
    OCR_TESSERACT_NOT_FOUND = "OCR_001"
    OCR_PROCESSING_FAILED = "OCR_002"
    OCR_LANGUAGE_NOT_SUPPORTED = "OCR_003"
    OCR_IMAGE_PROCESSING_FAILED = "OCR_004"

    # Configuration Errors (10000-10099)
    CONFIGURATION_MISSING_SETTING = "CONFIGURATION_001"
    CONFIGURATION_INVALID_VALUE = "CONFIGURATION_002"
    CONFIGURATION_FILE_NOT_FOUND = "CONFIGURATION_003"

    # Bridge Errors (11000-11099)
    BRIDGE_INVALID_ARGUMENTS = "BRIDGE_001"
    BRIDGE_PLUGIN_LOAD_FAILED = "BRIDGE_002"
    BRIDGE_CONVERTER_NOT_FOUND = "BRIDGE_003"
    BRIDGE_CONVERSION_EXECUTION_FAILED = "BRIDGE_004"
    BRIDGE_BATCH_EXECUTION_FAILED = "BRIDGE_005"
    BRIDGE_MERGE_EXECUTION_FAILED = "BRIDGE_006"
    BRIDGE_JSON_SERIALIZATION_FAILED = "BRIDGE_007"
    BRIDGE_INVALID_MODE = "BRIDGE_008"
    BRIDGE_VALIDATION_FAILED = "BRIDGE_009"
    BRIDGE_OUTPUT_DIRECTORY_INVALID = "BRIDGE_010"

    # Service Errors (12000-12099)
    SERVICE_BATCH_INVALID_CONVERSION_TYPE = "SERVICE_BATCH_001"
    SERVICE_BATCH_CONVERTER_NOT_FOUND = "SERVICE_BATCH_002"
    SERVICE_BATCH_FILE_PROCESSING_FAILED = "SERVICE_BATCH_003"
    SERVICE_BATCH_THREAD_POOL_FAILED = "SERVICE_BATCH_004"
    SERVICE_MERGE_INVALID_INPUT = "SERVICE_MERGE_001"
    SERVICE_MERGE_PDF_READ_FAILED = "SERVICE_MERGE_002"
    SERVICE_MERGE_PDF_WRITE_FAILED = "SERVICE_MERGE_003"
    SERVICE_MERGE_PDF_CORRUPTED = "SERVICE_MERGE_004"

    # Utils Errors (13000-13099)
    UTILS_FILE_OPERATION_FAILED = "UTILS_FILE_001"
    UTILS_FILE_READ_FAILED = "UTILS_FILE_002"
    UTILS_FILE_WRITE_FAILED = "UTILS_FILE_003"
    UTILS_FILE_COPY_FAILED = "UTILS_FILE_004"
    UTILS_FILE_DELETE_FAILED = "UTILS_FILE_005"
    UTILS_VALIDATION_FAILED = "UTILS_VALIDATION_001"
    UTILS_SECURITY_CHECK_FAILED = "UTILS_SECURITY_001"
    UTILS_METADATA_EXTRACTION_FAILED = "UTILS_METADATA_001"
    UTILS_CACHE_OPERATION_FAILED = "UTILS_CACHE_001"
    UTILS_CACHE_SERIALIZATION_FAILED = "UTILS_CACHE_002"
    UTILS_PERFORMANCE_MONITORING_FAILED = "UTILS_PERFORMANCE_001"


def get_error_message(error_code: str, context: dict[str, str] | None = None) -> str:
    """Get a human-readable error message for an error code.

    Args:
        error_code: The error code
        context: Optional context dictionary with additional details

    Returns:
        Human-readable error message
    """
    context = context or {}
    messages = {
        # Validation
        ErrorCode.VALIDATION_FILE_NOT_FOUND: f"File not found: {context.get('file_path', 'unknown')}",
        ErrorCode.VALIDATION_INVALID_FORMAT: f"Invalid file format: {context.get('format', 'unknown')}",
        ErrorCode.VALIDATION_FILE_TOO_LARGE: f"File too large: {context.get('size', 'unknown')}",
        # Conversion - Markdown
        ErrorCode.CONVERSION_MD2PDF_LIBRARY_MISSING: "markdown_pdf library is required but not installed",
        ErrorCode.CONVERSION_MD2PDF_READ_FAILED: f"Failed to read Markdown file: {context.get('file_path', 'unknown')}",
        ErrorCode.CONVERSION_MD2PDF_GENERATION_FAILED: "Failed to generate PDF from Markdown",
        # Conversion - PDF
        ErrorCode.CONVERSION_PDF2MD_READ_FAILED: f"Failed to read PDF file: {context.get('file_path', 'unknown')}",
        ErrorCode.CONVERSION_PDF2MD_TEXT_EXTRACTION_FAILED: "Failed to extract text from PDF",
        ErrorCode.CONVERSION_PDF2MD_OCR_FAILED: f"OCR processing failed: {context.get('reason', 'unknown')}",
        # Dependency
        ErrorCode.DEPENDENCY_MISSING_LIBRARY: f"Required library not found: {context.get('library', 'unknown')}",
        ErrorCode.DEPENDENCY_MISSING_EXECUTABLE: f"Required executable not found: {context.get('executable', 'unknown')}",
        # License
        ErrorCode.LICENSE_FEATURE_NOT_ACCESSIBLE: f"Feature not accessible: {context.get('feature', 'unknown')}",
        ErrorCode.LICENSE_FILE_SIZE_LIMIT_EXCEEDED: f"File size limit exceeded: {context.get('size', 'unknown')}",
        # OCR
        ErrorCode.OCR_TESSERACT_NOT_FOUND: "Tesseract OCR not found. Please install Tesseract OCR",
        ErrorCode.OCR_PROCESSING_FAILED: f"OCR processing failed: {context.get('reason', 'unknown')}",
    }

    base_message = messages.get(error_code, f"Error occurred: {error_code}")
    if context:
        for key, value in context.items():
            base_message = base_message.replace(f"{{{key}}}", str(value))
    return base_message

